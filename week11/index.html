<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        #container{
            display: flex;
            flex-wrap: wrap;
            width: 701px;
            height: 701px;
            overflow: hidden;
        }
        .item {
            width: 6px;
            height: 6px;
            border-bottom:solid 1px white;
            border-right:solid 1px white;
            background: black;
            vertical-align: middle;
        }
        .sp {
            background: green;
        }
    </style>
</head>
<body>
    <div id="container"></div>
    <button>保存图像</button>
    <script>
        let map = localStorage.getItem('map');
        let partten = map ? JSON.parse(map) : new Array(10000).fill(0);
        let mouseFlag = false;
        let clear = false;
        const container = document.getElementById('container');
        const btn = document.getElementsByTagName('button')[0];
        for(let i =0; i<100; i++){
            for(let j=0; j< 100; j++){
                const item = document.createElement('div');
                item.classList.add('item');
                container.appendChild(item);
                if(partten[i * 100 + j] === 1) {
                    item.classList.add('sp');  
                }
                item.addEventListener('mousemove', function(){
                    if(mouseFlag) {
                        if(clear) {
                            item.classList.remove('sp');
                            partten[i * 100 + j] = 0;
                        } else {
                            item.classList.add('sp');
                            partten[i * 100 + j] = 1;
                        }
                    }
                }, false)
            }
        }
        document.addEventListener('mousedown', function(ev){
            mouseFlag = true;
            if(ev.which == 3) { clear = true}
        }, false)
        document.addEventListener('mouseup', function(){
            mouseFlag = false;
        }, false)
        btn.addEventListener('click', function(){
            localStorage.setItem('map', JSON.stringify(partten))
        }, false)
        document.addEventListener('contextmenu', e => e.preventDefault())
        // 
        async function path(partten, start, end) {
            // 因为是广度优先搜索， 所以要用队列的数据结构， 深度优先搜索，就是用栈的数据结构
            let stack = [start];
            // 标识开始结束位置
            container.children[start[0] * 100 + start[1]].style.background = 'red'
            container.children[end[0] * 100 + end[1]].style.background = 'red'
            while(true) {
                // 从队列中获取第一个开始位置
                let [ x, y ] = stack.shift();
                // 搜索结束判断
                if(x == end[0] && y == end[1]) {
                    return
                }
                // 左右两个紧邻方向元素
                if(partten[(x-1) * 100 + y] === 0)
                    await insert(stack, x-1, y, [x, y]);
                if(partten[(x + 1) * 100 + y]  === 0)
                    await insert(stack, x+1, y, [x, y]);

                // 上下两个紧邻方向
                if(partten[x * 100 + y - 1] === 0)
                    await insert(stack, x, y - 1, [x, y]);
                if(partten[x * 100 + y + 1] === 0)
                    await insert(stack, x, y + 1, [x, y]);

                // 对角线紧邻方向
                if(partten[(x-1) * 100 + y - 1] === 0 && (partten[(x-1) * 100 + y] === 0 || partten[x * 100 + y - 1] === 0))
                    await insert(stack, x - 1, y - 1, [x, y]);

                if(partten[(x-1) * 100 + y + 1] === 0 && (partten[(x-1) * 100 + y] === 0 || partten[x * 100 + y + 1] === 0))
                    await insert(stack, x - 1, y + 1, [x, y]);

                if(partten[(x+1) * 100 + y - 1] === 0 && (partten[(x+1) * 100 + y] === 0 || partten[x * 100 + y - 1] === 0))
                    await insert(stack, x + 1, y - 1, [x, y]);
                if(partten[(x+1) * 100 + y + 1] === 0 && (partten[(x+1) * 100 + y] === 0 || partten[x * 100 + y + 1] === 0))
                    await insert(stack, x + 1, y + 1, [x, y]);
            }
            
        }
        // 将符合条件的点插入数据结构中
        async function insert(stack, x, y, prev){
            if(x<0 || y<0 || x>100 || y>100){return}
            stack.push([x, y]);
            await sleep(1);
            partten[x * 100 + y] = 2;
            container.children[x * 100 + y].style.background = 'pink'
        }
        function sleep(t){
            return new Promise((resolve, reject) => {
                setTimeout(resolve, t)
            })
        }
    </script>
</body>
</html>